{% extends 'base.html' %}

{% block content %}
<h2 class="text-3xl mb-4">Личный кабинет</h2>
<div class="profile-card mb-8">
    <div class="profile-header mb-4">
        <img src="{{ url_for('static', filename='images/default-avatar.png') }}" alt="Avatar" class="profile-avatar">
        <div class="profile-details">
            <h3>{{ current_user.email }}</h3>
            <p>Участник с: {{ current_user.created_at.strftime('%B %d, %Y') }}</p>
        </div>
    </div>
    <form method="POST" action="{{ url_for('profile_bp.upload_avatar') }}" enctype="multipart/form-data">
        <input type="file" name="avatar" class="form-input mb-2">
        <button type="submit" class="btn">Загрузить аватар</button>
    </form>
</div>

<div class="card mb-8">
    <h3 class="card-title mb-4">История запросов</h3>
    {% if search_history %}
        <ul class="list-disc list-inside">
            {% for history in search_history %}
                <li>{{ history.query }} ({{ history.timestamp.strftime('%Y-%m-%d %H:%M:%S') }})</li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="card-text">Запросов не найдено.</p>
    {% endif %}
</div>

<div class="card mb-8">
    <h3 class="card-title mb-4">История отзывов</h3>
    {% if reviews %}
        <ul class="list-disc list-inside">
            {% for review in reviews %}
                <li>
                    <strong>{{ movies_info[review.movie_id].title }}</strong>: {{ review.rating }} / 10
                    <p>{{ review.comment }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="card-text">Отзывов не найдено.</p>
    {% endif %}
</div>

<div class="card mb-8">
    <h3 class="card-title mb-4">История просмотренных фильмов</h3>
    {% if watched_movies %}
        <ul class="list-disc list-inside">
            {% for watched in watched_movies %}
                <li>
                    <strong>{{ movies_info[watched.movie_id].title }}</strong> ({{ watched.watched_date.strftime('%Y-%m-%d') }})
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="card-text">Просмотренных фильмов не найдено.</p>
    {% endif %}
</div>
{% endblock %}
